<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Accident / Incident Report</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
    h1 { text-align: center; }
    form { background: white; padding: 20px; border-radius: 10px; max-width: 700px; margin: auto; }
    label { font-weight: bold; display: block; margin-top: 15px; }
    input, textarea, select { width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; }
    button { margin-top: 20px; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
    .btn-primary { background: #007bff; color: white; }
    .btn-secondary { background: #28a745; color: white; margin-left: 10px; }
    .hidden { display: none; }
  </style>
</head>
<body>

<h1 id="formTitle">Accident / Incident Report Form</h1>

<!-- Language Selector -->
<label for="languageSelect" id="langLabel">Language / Lenguaje / Lang</label>
<select id="languageSelect" onchange="cambiarIdioma()">
  <option value="en">English</option>
  <option value="es">Español</option>
  <option value="ht">Kreyòl Ayisyen</option>
</select>

<form id="incidentForm">

  <!-- MOVIDO ARRIBA COMO PEDISTE -->
  <label id="accidentTypeLabel">Incident / Accident Type</label>
  <select id="tipo" onchange="actualizarCampos()" required>
    <option value="Incident">Incident</option>
    <option value="Accident">Accident</option>
  </select>

  <label id="employeeLabel">Employee Name</label>
  <input type="text" id="manager" required />

  <label id="dateLabel">Incident Date</label>
  <input type="date" id="fecha" required />

  <label id="departmentLabel">Department</label>
  <select id="departamento" required>
    <option value="" disabled selected>Select department</option>
    <option value="Water dep">Water dep</option>
    <option value="Spirits dep">Spirits dep</option>
    <option value="Brewery">Brewery</option>
    <option value="Packaging">Packaging</option>
    <option value="Maintenance">Maintenance</option>
    <option value="Tap Room">Tap Room</option>
    <option value="Quality">Quality</option>
    <option value="Other">Other</option>
  </select>

  <label id="locationLabel">Location of incident</label>
  <input type="text" id="location" />

  <label id="personsLabel">Data of person(s) involved</label>
  <textarea id="personas" rows="4"></textarea>

  <!-- TYPE OF EVENT - DINÁMICO -->
  <label id="eventTypeLabel">Type of Event</label>
  <select id="tipoEvento" onchange="mostrarSpecify()">
    <!-- opciones por defecto (cuando es INCIDENT) -->
    <option value="" disabled selected>Select one</option>
    <option value="near miss">Near Miss</option>
    <option value="injury">Injury</option>
    <option value="property damage">Property Damage</option>
    <option value="environmental impact">Environmental Impact</option>
    <option value="other">Other</option>
  </select>

  <div id="specifyBox" class="hidden">
    <label id="specifyLabel">Specify</label>
    <input type="text" id="specify" />
  </div>

  <!-- NATURE OF INJURY (solo para ACCIDENT) -->
  <div id="injuryNatureBox" class="hidden">
    <label>Nature of Injury/Illness</label>
    <select id="injuryNature">
      <option value="" disabled selected>Select one</option>
      <option value="Abrasion/Cut">Abrasion / Cut</option>
      <option value="Bruise/Contusion">Bruise / Contusion</option>
      <option value="Burn">Burn</option>
      <option value="Fracture">Fracture</option>
      <option value="Sprain/Strain">Sprain / Strain</option>
      <option value="Chemical Exposure">Chemical Exposure</option>
    </select>
  </div>

  <!-- BODY PART AFFECTED (solo para ACCIDENT) -->
  <div id="bodyPartBox" class="hidden">
    <label>Body Part(s) Affected</label>
    <input type="text" id="bodyPart" placeholder="Example: right hand, lower back, left eye, etc." />
  </div>

  <label id="descriptionLabel">Incident / Accident Description</label>
  <textarea id="descripcion" rows="5" required></textarea>

  <label id="witnessLabel">Data of Witness</label>
  <textarea id="witness" rows="4" placeholder="Full name, witness contact information, witness statement"></textarea>

  <label id="actionsLabel">Actions Taken</label>
  <textarea id="acciones" rows="4"></textarea>

  <!-- ROOT CAUSE ANALYSIS (solo para ACCIDENT) -->
  <div id="rootCauseBox" class="hidden">
    <label>Root Cause Analysis</label>
    <textarea id="rootCause" rows="4" placeholder="Immediate causes / underlying causes"></textarea>
  </div>

  <button type="button" class="btn-primary" onclick="enviarEmail()" id="sendBtn">Send by Email</button>
  <button type="button" class="btn-secondary" onclick="generarPDF()" id="pdfBtn">Generate PDF</button>
</form>

<script>
  const textos = {
    en: {
      formTitle: "Accident / Incident Report Form",
      langLabel: "Language",
      employeeLabel: "Employee Name",
      accidentTypeLabel: "Incident / Accident Type",
      dateLabel: "Incident Date",
      departmentLabel: "Department",
      locationLabel: "Location of incident",
      personsLabel: "Data of person(s) involved",
      eventTypeLabel: "Type of Event",
      specifyLabel: "Specify",
      descriptionLabel: "Incident / Accident Description",
      witnessLabel: "Data of Witness",
      actionsLabel: "Actions Taken",
      sendBtn: "Send by Email",
      pdfBtn: "Generate PDF"
    }
  };

  function cambiarIdioma() {
    const lang = document.getElementById("languageSelect").value;
    Object.keys(textos[lang]).forEach(id => {
      const el = document.getElementById(id);
      if (el) el.innerText = textos[lang][id];
    });

    document.getElementById("location").placeholder =
      lang === "es" ? "Área exacta donde ocurrió el evento" :
      lang === "ht" ? "Zòn egzak kote evènman an te fèt" :
      "Exact area where incident occurred";

    document.getElementById("personas").placeholder =
      "Full name, job title, department, supervisor, contact info";

    document.getElementById("witness").placeholder =
      "Full name, witness contact information, witness statement";
  }

  function mostrarSpecify() {
    const tipo = document.getElementById("tipoEvento").value;
    document.getElementById("specifyBox").classList.toggle("hidden", tipo !== "other");
  }

  function actualizarCampos() {
    const tipo = document.getElementById("tipo").value;

    const tipoEvento = document.getElementById("tipoEvento");
    const injuryNature = document.getElementById("injuryNatureBox");
    const bodyPart = document.getElementById("bodyPartBox");
    const rootCause = document.getElementById("rootCauseBox");

    if (tipo === "Accident") {
      tipoEvento.innerHTML = `
        <option value="" disabled selected>Select one</option>
        <option value="near miss">Near Miss</option>
        <option value="first aid only">First Aid Only</option>
        <option value="medical treatment">Medical Treatment</option>
        <option value="lost time">Lost Time</option>
        <option value="fatality">Fatality</option>
      `;
      injuryNature.classList.remove("hidden");
      bodyPart.classList.remove("hidden");
      rootCause.classList.remove("hidden");
    } else {
      tipoEvento.innerHTML = `
        <option value="" disabled selected>Select one</option>
        <option value="near miss">Near Miss</option>
        <option value="injury">Injury</option>
        <option value="property damage">Property Damage</option>
        <option value="environmental impact">Environmental Impact</option>
        <option value="other">Other</option>
      `;
      injuryNature.classList.add("hidden");
      bodyPart.classList.add("hidden");
      rootCause.classList.add("hidden");
    }
  }

  function obtenerDatos() {
    return {
      manager: manager.value,
      tipo: tipo.value,
      fecha: fecha.value,
      departamento: departamento.value,
      location: location.value,
      personas: personas.value,
      tipoEvento: tipoEvento.value,
      specify: specify.value,
      descripcion: descripcion.value,
      witness: witness.value,
      acciones: acciones.value,
      injuryNature: injuryNature.value || "",
      bodyPart: bodyPart.value || "",
      rootCause: rootCause.value || ""
    };
  }

  function enviarEmail() {
    const d = obtenerDatos();

    let cuerpo =
      `Employee: ${d.manager}%0D%0A` +
      `Type: ${d.tipo}%0D%0A` +
      `Date: ${d.fecha}%0D%0A` +
      `Department: ${d.departamento}%0D%0A` +
      `Location: ${d.location}%0D%0A` +
      `Persons involved: ${d.personas}%0D%0A` +
      `Event Type: ${d.tipoEvento}%0D%0A`;

    if (d.tipo === "Accident") {
      cuerpo +=
        `Nature of injury: ${d.injuryNature}%0D%0A` +
        `Body part(s): ${d.bodyPart}%0D%0A`;
    }

    cuerpo +=
      `Description: ${d.descripcion}%0D%0A` +
      `Witness: ${d.witness}%0D%0A` +
      `Actions taken: ${d.acciones}%0D%0A`;

    if (d.tipo === "Accident") {
      cuerpo += `Root Cause Analysis: ${d.rootCause}`;
    }

    window.location.href =
      `mailto:safety@turksheadbeer.com?subject=${d.tipo} Report - ${d.fecha}&body=${cuerpo}`;
  }

</script>

</body>
</html>




