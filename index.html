<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Accident / Incident Reports</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
    h1 { text-align: center; }
    form { background: white; padding: 20px; border-radius: 10px; max-width: 700px; margin: auto; }
    label { font-weight: bold; display: block; margin-top: 15px; }
    input, textarea, select { width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; }
    button { margin-top: 20px; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
    .btn-primary { background: #007bff; color: white; }
    .btn-secondary { background: #28a745; color: white; margin-left: 10px; }
    .hidden { display: none; }
  </style>
</head>
<body>

<h1>Accident / Incident Report Form</h1>

<form id="incidentForm">
  <label>Employee Name</label>
  <input type="text" id="manager" required />

  <label>Incident / Accident Type</label>
  <select id="tipo" required>
    <option value="Incident">Incident</option>
    <option value="Accident">Accident</option>
  </select>

  <label>Incident Date</label>
  <input type="date" id="fecha" required />

  <label>Department</label>
  <select id="departamento" required>
    <option value="" disabled selected>Select department</option>
    <option value="Water dep">Water dep</option>
    <option value="Spirits dep">Spirits dep</option>
    <option value="Brewery">Brewery</option>
    <option value="Packaging">Packaging</option>
    <option value="Maintenance">Maintenance</option>
    <option value="Tap Room">Tap Room</option>
    <option value="Quality">Quality</option>
    <option value="Other">Other</option>
  </select>

  <!-- NEW FIELDS INSERTED HERE -->

  <label>Location</label>
  <input type="text" id="location" placeholder="Exact area where the event occurred" />

  <label>Data of person(s) involved</label>
  <textarea id="personas" rows="4"
    placeholder="Full name, job title, department, supervisor's name, contact information"></textarea>

  <label>Type of Event</label>
  <select id="tipoEvento" onchange="mostrarSpecify()">
    <option value="" disabled selected>Select one</option>
    <option value="near miss">Near Miss</option>
    <option value="injury">Injury</option>
    <option value="property damage">Property Damage</option>
    <option value="environmental impact">Environmental Impact</option>
    <option value="other">Other</option>
  </select>

  <div id="specifyBox" class="hidden">
    <label>Specify</label>
    <input type="text" id="specify" />
  </div>

  <!-- END OF INSERTED FIELDS -->

  <label>Incident / Accident Description</label>
  <textarea id="descripcion" rows="5" required></textarea>

  <!-- WITNESS FIELD -->
  <label>Data of Witness</label>
  <textarea id="witness" rows="4"
   placeholder="Full name, witness contact information, witness statement"></textarea>

  <label>Actions Taken</label>
  <textarea id="acciones" rows="4"></textarea>

  <button type="button" class="btn-primary" onclick="enviarEmail()">Send by Email</button>
  <button type="button" class="btn-secondary" onclick="generarPDF()">Generate PDF</button>
</form>

<script>

  function mostrarSpecify() {
    const tipo = document.getElementById("tipoEvento").value;
    const box = document.getElementById("specifyBox");
    box.classList.toggle("hidden", tipo !== "other");
  }

  function obtenerDatos() {
    return {
      manager: document.getElementById("manager").value,
      tipo: document.getElementById("tipo").value,
      fecha: document.getElementById("fecha").value,
      departamento: document.getElementById("departamento").value,
      location: document.getElementById("location").value,
      personas: document.getElementById("personas").value,
      tipoEvento: document.getElementById("tipoEvento").value,
      specify: document.getElementById("specify").value,
      descripcion: document.getElementById("descripcion").value,
      witness: document.getElementById("witness").value,
      acciones: document.getElementById("acciones").value
    };
  }

  function enviarEmail() {
    const data = obtenerDatos();
    const cuerpo =
      `Manager: ${data.manager}%0D%0A` +
      `Incident Type: ${data.tipo}%0D%0A` +
      `Date: ${data.fecha}%0D%0A` +
      `Department: ${data.departamento}%0D%0A` +
      `Location: ${data.location}%0D%0A` +
      `Persons involved: ${data.personas}%0D%0A` +
      `Event type: ${data.tipoEvento}%0D%0A` +
      `Specify: ${data.specify}%0D%0A` +
      `Description: ${data.descripcion}%0D%0A` +
      `Witness: ${data.witness}%0D%0A` +
      `Actions: ${data.acciones}`;

    window.location.href =
      `mailto:safety@turksheadbrewery.com?subject=${data.tipo} Report - ${data.fecha}&body=${cuerpo}`;
  }

  function generarPDF() {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    const data = obtenerDatos();

    pdf.setFontSize(14);
    pdf.text(`${data.tipo} Report`, 20, 20);

    pdf.setFontSize(11);
    pdf.text(`Manager: ${data.manager}`, 20, 35);
    pdf.text(`Type: ${data.tipo}`, 20, 45);
    pdf.text(`Date: ${data.fecha}`, 20, 55);
    pdf.text(`Department: ${data.departamento}`, 20, 65);
    pdf.text(`Location: ${data.location}`, 20, 75);
    pdf.text(`Persons involved: ${data.personas}`, 20, 90, { maxWidth: 170 });
    pdf.text(`Event type: ${data.tipoEvento}`, 20, 120);
    if (data.tipoEvento === "other") {
      pdf.text(`Specify: ${data.specify}`, 20, 130);
    }

    pdf.text("Description:", 20, 145);
    pdf.text(data.descripcion, 20, 155, { maxWidth: 170 });

    pdf.text("Witness:", 20, 185);
    pdf.text(data.witness, 20, 195, { maxWidth: 170 });

    pdf.text("Actions Taken:", 20, 225);
    pdf.text(data.acciones, 20, 235, { maxWidth: 170 });

    pdf.save(`${data.tipo.toLowerCase()}_report_${data.fecha}.pdf`);
  }

</script>

</body>
</html>
